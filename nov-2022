pipeline{
agent any
 
tools{
maven 'maven3.8.4'
}
 
stages{
  //get the code from github
   stage('checkoutcode'){
   steps{
   git credentialsId: '8fe5a442-8af5-4c8f-acd2-2dd7dcbc1cb9', url: 'https://github.com/mss-ec-apps-ki/maven-web-application.git'
}
}
//do the build
stage('build'){
steps{
sh"mvn clean package"
}
}
//execute sonarqubereport
stage('sonarqubereport'){
steps{
sh"mvn clean sonar:sonar"
}
}
//uploadartifactsintonnexus
stage('uploadartifactsintorepo'){
steps{
sh"mvn deploy"
}
}
//deploy app into tomcat
stage('deeployapplicationintotomcatserver'){
steps{
sshagent(['df27f240-508e-4be6-b376-a643fbd47802']) {
    sh "scp -o stricthostkeychecking=no target/maven-web-application.war ec2-user@65.2.5.70:/opt/apache-tomcat-9.0.58/webapps/"
  
}
}
}



}//stages closing
}//pipeline closing
